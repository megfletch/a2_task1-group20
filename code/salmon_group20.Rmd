---
title: "Salmon-Group20"
author: "Meghan Fletcher, Peyton Moore, Mariano Viz "
date: "2/4/2021"
output: 
  html_document:
    code_folding: hide
    theme: cosmo
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
library(here)
library(tidyverse)
library(janitor)
library(lubridate)
library(tsibble)
library(scales)

library(prettydoc)
library(feasts)
library(fable)
library(patchwork)

# For time series data
library(tsibble)
library(feasts)
library(fable)
library(urca)

```


```{r}
#INITIAL WRANGLING:

#Read in data and update to lower case:
willamette_fish_passage <- read_csv(here("data", "willamette_fish_passage.csv"))%>% 
  clean_names()

#Mutate date to class "Date" and convert data to time series data frame (tsibble):
willamette_ts <- willamette_fish_passage %>% 
  mutate(date = mdy(date)) %>%
  as_tsibble(key = NULL, index = date)
  


```



## Overview
This “Overview” section (above the tabs) should contain, in whatever order you choose:

- An engaging image (with caption, including photo credit) that is relevant to the dataset

- A brief summary (3 - 4 sentences) of the dataset, and what is included in this “report”

- A map of the fish ladder location (you can make this in R on your own, or include an existing map appropriately licensed, with attribution)

- A professionally formatted data citation

- Remember: All code that you used to wrangle the data and prepare the graphs should be available to see if we click on the Code buttons.



## Fish passage at the Willamette Falls, Willamette River (Oregon) {.tabset}


### Tab 1: Time Series of salmon passage

```{r}
# Read in data
fish_data <- read_csv(here("data", "willamette_fish_passage.csv")) %>% 
  clean_names()

# Select for coho, jack coho and steelhead
fish_clean <- fish_data %>% 
  select("date", "steelhead", "coho", "jack_coho") %>% 
  mutate(across(where(is.numeric), ~ ifelse(is.na(.), 0, .)))
```

```{r}
# Wrangle data in preparation for time series
fish_ts <- fish_clean %>% 
  mutate(date = lubridate::myd(date)) %>% 
  as_tsibble(key = NULL, index = date) 
```

```{r, fig.cap="**Figure 1:** This graph shows that trend in steelhead salmon migration through the Columbia River and gives projections to 2031."}
# Steelhead salmon
ggplot(data = fish_ts, aes(x = date, y = steelhead, color = steelhead)) +
  geom_line(color = "palegreen4") +
  theme_minimal() +
  labs(x = "Year", y = "Steelhead Salmon", title = "Steelhead Salmon Passage over Time")
```

```{r, fig.cap="**Figure 2:** This graph shows that trend in coho salmon migration through the Columbia River and gives projections to 2031."}
# Coho slamon
ggplot(data = fish_ts, aes(x = date, y = coho, color = coho)) +
  geom_line(color = "red3") +
  theme_minimal() +
  labs(x = "Year", y = "Coho Salmon", title = "Coho Salmon Passage over Time")
```

```{r, fig.cap="**Figure 3:** This graph shows that trend in jack coho salmon migration through the Columbia River and gives projections to 2031."}
# Jack Coho salmon
ggplot(data = fish_ts, aes(x = date, y = jack_coho, color = jack_coho)) +
  geom_line(color = "orange1") +
  theme_minimal()+
  labs(x = "Year", y = "Jack Coho Salmon", title = "Jack Coho Salmon Passage over Time")
```
From the times series graphs on steelhead, coho and jack coho salmon, we can see that:

1. All three types of salmon pass have strong, seasonal migratory patterns through the Columbia River.

2. Steelhead salmon numbers have remained relatively constant and are predicted to remain constant through 2030 while coho and jack coho salmon numbers are expected to increase.

3. Steelhead salmon spend a greater time on average in the Columbia River than do either of the other two species. 

### Tab 2: Season Plots 


```{r, Season Plots, message=FALSE, warning = FALSE}
willamette_long <- willamette_ts %>% 
  pivot_longer(cols = chinook_run:pink, 
               names_to = "species", 
               values_to = "counts") %>% 
  filter(species %in% c("coho", "jack_coho", "steelhead"))


coho_season <- willamette_long %>% 
  filter(species == "coho") %>% 
  gg_season(y = counts, 
            period = "year", 
            show.legend = FALSE)+
  ylim(0,1000)+
  theme_minimal()+
  labs(x= "", y = "", title = "Coho")

#coho_season

jack_coho_season <- willamette_long %>% 
  filter(species == "jack_coho") %>% 
  gg_season(y = counts, 
            period = "year")+
  theme_minimal()+
  ylim(0,1000)+
  labs(x= "", 
       y = "Number of Observations", title = "Jack-Coho")

#jack_coho_season


steelhead_season <- willamette_long %>% 
  filter(species == "steelhead") %>% 
  gg_season(y = counts, 
            period = "year", 
            show.legend = FALSE)+
  theme_minimal()+
  ylim(0,1000)+
  labs(x= "Month", y = "", title = "Steelhead") 


patch_season <- (coho_season/jack_coho_season/steelhead_season)+
  plot_annotation(title = "Coho, Jack-Coho, and Steelhead Seasonal Abundance in Willamette Falls \nfrom 2001-2010")

patch_season
```
**Figure 4.** Abundance of Coho, Jack-Coho and Steelhead seasonally observed in at Willamette Falls fish ladder Willamette, Oregon. These observations range from 2001-2010.Year is indicated by color. Data: [Columbia River DART](http://www.cbr.washington.edu/dart/query/adult_graph_text) (Data Access in Real Time).

- Coho and Jack-Coho are consistently at peak abundance in October, with at least small numbers of individuals present from August to November. 
- The number of Coho observed seems to have increased in recent years. 
- Observations of Steelhead are more diffuse throughout the year with the most observations ranging from February to July.


### Tab 3: Summary statistics and analysis

```{r}
willamette_fish_annual <- willamette_fish_passage %>%
  mutate(date = mdy(date)) %>%
  mutate(date_year = year(date)) 

coho_annual <- willamette_fish_annual %>%
  count(date_year, wt = coho)
jack_coho_annual <- willamette_fish_annual %>%
  count(date_year, wt = jack_coho)
steelhead_annual <- willamette_fish_annual %>%
  count(date_year, wt = steelhead)

 

ggplot()+ 
  geom_line(data = coho_annual, aes(x = date_year, y = n, color = "Coho"), size = 0.7) +
  geom_line(data = jack_coho_annual, aes(x = date_year, y = n, color = "Jack Coho"), size = 0.7) +
  geom_line(data = steelhead_annual, aes(x = date_year, y = n, color = "Steelhead"), size = 0.7) +
  scale_x_continuous(breaks=c(2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010), limits = c(2001,2010)) + 
  scale_color_manual(values = c( "Coho" = "red3", "Jack Coho" = "orange1", "Steelhead" = "palegreen4"))+
  labs(color = "Species")+
  scale_y_continuous(labels = scales::label_number_si())+
  labs(x = "Year",
       y = "Counts",
       title = "Annual counts by Species, Willamette Falls (2001-2010)") +
  theme_minimal()



```

**Figure 5.** Annual counts by species at the Willamette Falls fish ladder, Willamette
River, Oregon (2001-2010). Red, orange, and green lines indicate counts for the species coho, jack coho, and steelhead, respectively. Data: [Columbia River DART](http://www.cbr.washington.edu/dart/query/adult_graph_text) (Data Access in Real Time).




**Summary**

Annual counts of coho, jack coho, and steelhead species on the Willamette Falls fish ladder (2001-2010) show the following major trends:  

● An overall low number of the jack coho species for the entire time period 2001-2010 

● A marked increase in the counts of individuals of the coho species for the years 2009-2010

● A high number of individuals of the steelhead species for the period 2001-2004 followed by a relative decrease in the years 2005-2009 and a recent increase in the year 2010



